<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NYC Candidate Speed Match</title>
  <style>
    body { 
      font-family: sans-serif; 
      max-width: 700px; 
      margin: 0 auto; 
      padding: 0;
    }
    .header {
      background-color: #0047FF;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: bold;
      text-transform: uppercase;
    }
    .header .menu-icon {
      font-size: 24px;
    }
    .content {
      padding: 20px;
    }
    .intro-title {
      color: #0047FF;
      border-bottom: 1px solid #0047FF;
      padding-bottom: 10px;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .info-text {
      margin-bottom: 20px;
      line-height: 1.5;
    }
    .skip-link {
      color: #0047FF;
      text-decoration: none;
      font-weight: bold;
    }
    .start-button {
      background-color: #00FF00;
      color: black;
      border: none;
      padding: 15px 20px;
      width: 100%;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 350px;
    }
    .question-number {
      color: #0047FF;
      margin: 20px 20px 5px 20px;
      padding-bottom: 5px;
      border-bottom: 1px solid #0047FF;
    }
    .question-text {
      color: #0047FF;
      font-size: 24px;
      font-weight: bold;
      margin: 10px 20px 15px 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #0047FF;
    }
    .option-item {
      padding: 15px 20px;
      position: relative;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }
    .option-item.selected {
      background-color: #e0e7ff;
    }
    .option-number {
      font-weight: bold;
      margin-right: 10px;
      display: inline-block;
      vertical-align: top;
      min-width: 20px;
    }
    .option-text {
      display: inline-block;
      width: calc(100% - 30px);
      vertical-align: top;
    }
    .navigation {
      display: flex;
      margin: 20px;
    }
    .nav-button {
      padding: 15px 0;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    .back-button {
      flex: 1;
      background-color: white;
      color: black;
      border: 1px solid #ddd;
      margin-right: 10px;
    }
    .next-button {
      flex: 1;
      background-color: #00FF00;
      color: black;
    }
    #quiz-container, #results {
      display: none;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Speed Matching</h1>
    <div class="menu-icon">&#9776;</div>
  </div>
  
  <div id="intro-content" class="content">
    <h2 class="intro-title">Before You Start</h2>
    
    <div class="info-text">
      This quiz has 13 questions and takes approximately 5-8 minutes to complete.
    </div>
    
    <div class="info-text">
      Each answer comes from a real candidate's proposal. Pick the one you agree with.
    </div>
    
    <div class="info-text">
      If you choose <a href="#" class="skip-link">Skip this question</a>, that question won't count toward your final match.
    </div>
    
    <button id="start-quiz" class="start-button">Start The Quiz</button>
  </div>

  <div id="quiz-container"></div>
  <div id="results"></div>

  <script>
    // This script creates the UI, then loads and connects to your existing script.js
    document.addEventListener('DOMContentLoaded', function() {
      // Initially show the intro content
      document.getElementById('intro-content').style.display = 'block';
      document.getElementById('quiz-container').style.display = 'none';
      document.getElementById('results').style.display = 'none';
      
      // Handle Start Quiz button click
      document.getElementById('start-quiz').addEventListener('click', function() {
        document.getElementById('intro-content').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        
        // Load the script.js file dynamically after clicking start
        var scriptElement = document.createElement('script');
        scriptElement.src = 'script.js';
        
        // Before loading the script, define a global function to override the original showQuestion
        window.originalShowQuestion = window.showQuestion; // Save original if it exists
        
        window.showQuestion = function(index) {
          const q = quiz[index];
          const quizContainer = document.getElementById('quiz-container');
          
          let html = `
            <div class="question-number">Question ${index + 1}/${quiz.length}</div>
            <div class="question-text">${q.question}</div>
          `;
          
          q.options.forEach((opt, i) => {
            const isSelected = userAnswers[index]?.text === opt.text ? 'selected' : '';
            html += `<div class="option-item ${isSelected}" onclick="selectOption(${i}, ${index})">
              <span class="option-number">${i + 1}.</span>
              <span class="option-text">${opt.text}</span>
            </div>`;
          });
          
          html += `
            <div class="navigation">
              ${index > 0 ? '<button class="nav-button back-button" onclick="goBack()">Back</button>' : '<div style="flex: 1;"></div>'}
              <button class="nav-button next-button" onclick="nextQuestion()">Next</button>
            </div>
          `;
          
          quizContainer.innerHTML = html;
        };
        
        // Add helper functions for the UI
        window.selectedOptionIndex = -1;
        
        window.selectOption = function(optionIndex, questionIndex) {
          window.selectedOptionIndex = optionIndex;
          
          // Remove selected class from all options
          const options = document.querySelectorAll('.option-item');
          options.forEach(option => option.classList.remove('selected'));
          
          // Add selected class to clicked option
          options[optionIndex].classList.add('selected');
        };
        
        window.nextQuestion = function() {
          if (window.selectedOptionIndex >= 0) {
            const currentQ = quiz[currentQuestionIndex];
            handleAnswer(currentQ.options[window.selectedOptionIndex]);
            window.selectedOptionIndex = -1;
          } else {
            // Check if any option is selected (in case the user clicked directly)
            const selectedOption = document.querySelector('.option-item.selected');
            if (selectedOption) {
              const index = Array.from(document.querySelectorAll('.option-item')).indexOf(selectedOption);
              const currentQ = quiz[currentQuestionIndex];
              handleAnswer(currentQ.options[index]);
            } else {
              alert('Please select an option or skip this question');
            }
          }
        };
        
        // Override showResults to match the new UI
        window.originalShowResults = window.showResults;
        window.showResults = function() {
          document.getElementById('quiz-container').style.display = 'none';
          document.getElementById('results').style.display = 'block';
          
          // Filter out candidates with zero points
          const nonZeroResults = Object.entries(candidates)
            .filter(([_, score]) => score > 0)
            .sort((a, b) => b[1] - a[1]);
        
          let resultHTML = '<h2>Your Top Candidates</h2>';
          
          if (nonZeroResults.length === 0) {
            resultHTML += '<p>No candidates matched your preferences. Try answering more questions.</p>';
          } else {
            // Show up to top 5 candidates with non-zero scores
            const topCandidates = nonZeroResults.slice(0, 5);
            resultHTML += topCandidates.map(([name, score], i) => 
              `<p>${i + 1}. ${name} – ${score} point(s)</p>`
            ).join('');
          }
        
          resultHTML += `<p>Questions skipped: ${questionStats.skipped}</p>`;
        
          // Add Google Form iframe
          resultHTML += `
          <div style="margin-top: 30px;">
          <h3>Please give us your feedback</h3>
          <div style="position: relative; width: 100%; max-width: 360px; overflow: hidden; padding-top: 225%;"> 
            <iframe 
              src="https://docs.google.com/forms/d/e/1FAIpQLScEWVuPKAJkjz8iLnl9WkIFf7fDsDjsbboN0VRR13_JCNy4ug/viewform?embedded=true" 
              style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
              marginheight="0" 
              marginwidth="0">
              Loading…
            </iframe>
          </div>
        </div>
        `;
        
          document.getElementById('results').innerHTML = resultHTML;
        };
        
        document.body.appendChild(scriptElement);
      });
    });
  </script>
</body>
</html>